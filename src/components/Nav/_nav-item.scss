// TODO refactor to reduce nesting
// stylelint-disable max-nesting-depth
.nav__item {
  &.nav__item {
    margin: 0;
    padding: 0;
    position: static;

    &:before {
      content: none;
    }
  }

  .first {
    display: none;
  }

  // TODO: update breakpoint mixin to allow max-width which also removes a pixel
  @media screen and (max-width: calc(map-get($breakpoints, md) - 1px)) {
    border-bottom: 1px solid var(--colour-grey-05);

    .nav-secondary &.first {
      display: block;
    }
  }
}

.nav__link {
  align-items: center;
  display: flex;
  justify-content: space-between;
  height: 100%;
  letter-spacing: rem(0.43);
  line-height: 1.4;
  padding:
    calc(2.25 * var(--space-unit))
    calc(1.5 * var(--space-unit))
    calc(2.25 * var(--space-unit))
    calc(2 * var(--space-unit));
  text-decoration: none;

  @include breakpoint(sm) {
    padding-left: calc(4 * var(--space-unit));
    padding-right: calc(4 * var(--space-unit));
  }

  @include breakpoint(md) {
    color: var(--colour-white);
    padding: calc(2 * var(--space-unit));

    &:active,
    &:focus,
    &:hover,
    &.active {
      color: var(--colour-white);
    }

    .nav__link-text:before {
      background-color: var(--colour-white);
    }

    .icon {
      display: none;
    }

    &.active + .nav-secondary {
      display: block;
    }
  }

  &:focus,
  &:hover {
    text-decoration: none;
  }

  &:active,
  &:focus,
  &:hover,
  &.active {
    color: var(--colour-blue-80);
  }

  .nav__link-text {
    align-items: center;
    display: flex;
    height: 100%;
    padding-top: calc(0.5 * var(--space-unit));
    padding-bottom: calc(0.5 * var(--space-unit));
    position: relative;
  }

  .nav__link-text:before {
    background-color: var(--colour-blue-80);
    bottom: 0;
    content: '';
    height: calc(0.25 * var(--space-unit));
    left: 0;
    position: absolute;
    transform: scaleX(0);
    transition: all 0.3s ease-in-out;
    width: 100%;
  }

  &.active .nav__link-text:before,
  &:hover .nav__link-text:before {
    transform: scaleX(1);
    width: 100%;
  }

  .nav-secondary & {
    @include breakpoint(md) {
      align-items: stretch;
    }
  }
}

.nav__pane {
  background: var(--colour-white);
  left: 0;
  position: absolute;
  z-index: 1;

  // TODO update breakpoint mixin to include max-width
  @media screen and (max-width: calc(map-get($breakpoints, md) - 1px)) {
    border-top: 1px solid var(--colour-grey-05);
    bottom: 0;
    right: 0;
    top: calc(8 * var(--space-unit));
    transform: translate3d(100%, 0, 0);
    transition:
      transform ease 0.4s,
      0s visibility ease 0.4s;
    visibility: hidden;
    z-index: 3;

    .is-active {
      top: 0;
      z-index: 4;
    }

    &.is-active {
      transform: translate3d(0, 0, 0);
      transition:
        transform ease 0.4s,
        visibility ease 0.4s;
      visibility: visible;
    }
  }

  @include breakpoint(md) {
    box-shadow:
      0 calc(0.5 * var(--space-unit)) calc(1.5 * var(--space-unit))
      0 rgba(0, 0, 0, 0.1);
    display: none;
    padding: 0 5%;
    top: 100%;
    width: 100%;

    .nav__link {
      color: var(--colour-blue-80);
      //font-size: var(--text-sm);
      min-height: calc(4 * var(--space-unit));
      padding: 0 calc(2 * var(--space-unit));
    }

    .nav__link:hover,
    .nav__link.active {
      color: var(--colour-blue-80);
    }

    .nav__link-text:before {
      background-color: var(--colour-blue-80);
    }

    ul {
      margin: 0 auto;
      max-width: $max-width;
      padding: 0 0 0 calc(13.5 * var(--space-unit));
    }
  }
}
